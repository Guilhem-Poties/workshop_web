<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAGE QUESTION</title>
</head>

<body>
    <header>
        <h1>QUIZOO</h1>
        <button onclick="">Quitter</button>
        <!-- Retour à l'accueil -->
    </header>

    <div class="global-container">
        <!-- RÉCUPÉRER LES QUESTIONS ET LES RÉPONSES ASSOCIÉES ET LES AFFICHER -->

        <div class="question">
            <div class="question-container">
            </div>
            <div class="reponse-container">
                <img id="reponse-0" src="" width="500" height="600" alt="" onclick="check_reponse(0)">
                <img id="reponse-1" src="" width="500" height="600" alt="" onclick="check_reponse(1)">
                <img id="reponse-2" src="" width="500" height="600" alt="" onclick="check_reponse(2)">
            </div>
        </div>
    </div>
    <div class="correction-container">
        <p id="correction" visibility="hidden"></p>
        <button id="bouton-suivant" type="button" onclick="question_suivante()" style="visibility: hidden;" disabled>SUIVANT</button>
    </div>

    <script>
        const list_questions = await fetch("/question", method = "GET");
        var question_actuelle = {};
        var reponses = {};
        var compteur_question = 0;
        var texte_bonne_reponse = "";

        window.addEventListener("load", (event) => {
            question_suivante();
        });

        function display_question() {
            document.getElementsByClassName("question-container")[0].innerHTML = ` <h2>Question ` + compteur_question + `</h2> 
                                                                                <p>` + question_actuelle["libelle"] + `</p>`;

            for (const reponse in reponses) {
                var image = document.getElementById(`reponse-` + reponse);
                image.setAttribute("src", reponses[reponse]["image"]);
                image.setAttribute("alt", reponses[reponse]["libelle"]);
                image.setAttribute("onclick", `check_reponse(` + reponse + `)`)

                if (question_actuelle["bonne reponse"] == reponses[reponse]["id"]) {
                    texte_bonne_reponse = reponses[reponse]["libelle"];
                }
            }

            var bouton = document.getElementById("bouton-suivant");
            var correction = document.getElementById("correction");

            bouton.style.visibility = "hidden";
            bouton.disabled = true
            correction.style.visibility = "hidden";
        }

        function check_reponse(reponse) {
            var bouton = document.getElementById("bouton-suivant");
            var correction = document.getElementById("correction");

            if (reponses[reponse]["id"] == question_actuelle["bonne reponse"]) {
                var texte = `Correct ! La bonne réponse est bien `;
            } else {
                var texte = `Faux ! La bonne réponse était `
            }

            bouton.style.visibility = "visible";
            bouton.disabled = false;
            correction.style.visibility = "visible";
            correction.innerHTML = texte + texte_bonne_reponse;

            for (const element in reponses) {
                document.getElementById(`reponse-` + element).removeAttribute("onclick")
            }
        }

        function question_suivante() {
            question_actuelle = list_questions[compteur_question];
            reponses = question_actuelle["reponses"];
            compteur_question++;

            display_question();
        }
    </script>

</body>

</html>